<!DOCTYPE html> 
<html lang="ar"> 
<head> 
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <!-- رابط Bootstrap للحصول على التصميم الجاهز للبطاقات والأزرار --> 
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js"></script> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> 
    <link rel="preconnect" href="https://fonts.googleapis.com"> 
    <!-- Font Awesome 6.x for fa-solid fa-bars fa-xl (if you use it) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>صفحة انشاء حساب للطبيب</title> 
    <link rel="stylesheet" href="./src/signup.css"> 
    <link rel="shortcut icon" href="https://github.com/MaisSerhan/Haven/blob/main/Assets/images/HalfTranLogo.png?raw=true"> 
    <style> 
    </style> 
</head> 
<body> 
    <div class="container text-center"> 
        <a class="navbar-brand logo fs-2" href="../../index.html"> 
            <img src="https://github.com/MaisSerhan/Haven/blob/main/Assets/images/HalfTranLogo.png?raw=true" alt="Haven Logo" class="logo" width="50px"> 
            <span class="i18n-haven-title">هافن</span> 
        </a> 
        <h2>إنشاء حساب للطبيب</h2> 
        <!-- إضافة ID للنموذج و enctype لرفع الملفات -->
        <form class="form-box" id="doctorSignupForm" enctype="multipart/form-data"> 
            <div class="input-box"> 
                <label for="name">اسم المستخدم</label> <!-- تغيير username إلى name -->
                <input type="text" id="name" name="name" placeholder="أدخل اسم المستخدم" required> 
            </div> 
            <div class="input-box"> 
                <label for="email">البريد الإلكتروني</label> 
                <input type="email" id="email" name="email" placeholder="أدخل بريدك الإلكتروني" required> 
            </div> 
            <div class="input-box"> 
                <label for="password">كلمة المرور</label> 
                <input type="password" id="password" name="password" placeholder="أدخل كلمة المرور" required> 
                <button type="button" class="toggle-password" onclick="togglePassword('password', this)"><i class="fa fa-eye" style="color: #ff3f7e;"></i></button> 
            </div> 
            <div class="input-box mb-2"> 
                <label for="confirm-password">تأكيد كلمة المرور</label> 
                <!-- **التعديل هنا: إضافة name="confirmPassword"** -->
                <input type="password" id="confirm-password" name="confirmPassword" placeholder="أكد كلمة المرور" required> 
                <button type="button" class="toggle-password" onclick="togglePassword('confirm-password', this)"><i class="fa fa-eye" style="color: #ff3f7e;"></i></button> 
            </div> 
            <!-- اختيار التخصص --> 
            <div class="input-box inline-flex me-5 me-sm-1"> 
                <label for="major">اختر التخصص</label> <!-- تغيير stage إلى major -->
                <select id="major" name="major" required> 
                    <option value="">-- اختر التخصص --</option> 
                    <option value="نسائية وتوليد">نسائية وتوليد</option> 
                    <option value="طبيب أطفال">طبيب أطفال</option> 
                </select> 
            </div> 
            <!-- اختيار المدينة --> 
            <span class="input-box inline-flex"> 
                <label for="city_id">اختر مدينتك</label> <!-- تغيير city إلى city_id -->
                <select id="city_id" name="city_id" required> 
                    <option value="">-- اختر المدينة --</option> 
                    <option value="1">رام الله والبيرة</option> 
                    <option value="2">الخليل</option> 
                    <option value="3">نابلس</option> 
                    <option value="4">طولكرم</option> 
                    <option value="5">بيت لحم</option> 
                    <option value="6">جنين</option> 
                    <option value="7">القدس</option> 
                    <option value="8">غزة</option> 
                    <option value="9">أريحا</option> 
                    <option value="10">طوباس</option> 
                </select> 
            </span> 
            <div class="input-box mt-3"> 
                <label for="location">أدخل موقعك الجغرافي </label> <!-- تغيير Location إلى location -->
                <input type="text" id="location" name="location" placeholder="أدخل موقعك" required> 
            </div> 
            <div class="input-box"> 
                <label for="phone">رقم الهاتف</label> 
                <input type="tel" id="phone" name="phone" placeholder="أدخل رقم الهاتف" required pattern="^\+?\d{8,15}$"> 
            </div> 
            <!-- رفع صورة --> 
            <div class="input-box text-center"> 
                <label for="profile-picture">الصورة بطاقة الدكتور</label> 
                <input type="file" class="text-center" id="profile-picture" name="file" accept="image/*" required> <!-- تغيير name إلى file -->
            </div> 
            <div class="mt-2"> 
                <button type="submit">إنشاء الحساب</button> 
                <a href="./login.html">لديك حساب بالفعل؟ تسجيل الدخول</a> 
            </div> 
        </form> 
    </div> 
    <script> 
        function togglePassword(id, button) { 
            const input = document.getElementById(id); 
            const icon = button.querySelector('i'); 
            if (input.type === 'password') { 
                input.type = 'text'; 
                icon.classList.remove('fa-eye'); 
                icon.classList.add('fa-eye-slash'); 
            } else { 
                input.type = 'password'; 
                icon.classList.remove('fa-eye-slash'); 
                icon.classList.add('fa-eye'); 
            } 
        } 

        // معالجة إرسال النموذج للطبيب
        document.getElementById('doctorSignupForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const form = e.target;
            const formData = new FormData(form);

            // Client-side password confirmation
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            if (password !== confirmPassword) {
                alert('كلمات المرور غير متطابقة!');
                return;
            }

            try {
                const response = await fetch("http://localhost:3001/auth/doctorRegister", {
                    method: "POST",
                    body: formData 
                });

                const result = await response.json();

                if (response.ok) {
                    alert("تم إنشاء حساب الطبيب بنجاح!");
                    window.location.href = "./login.html"; 
                } else {
                    console.error("Backend response status:", response.status);
                    console.error("Backend response result:", result);
                    // تحسين عرض رسائل الأخطاء من الـ Backend
                    if (result && result.errors && Array.isArray(result.errors) && result.errors.length > 0) {
                        const errorMessages = result.errors.map(err => err.msg).join("\n");
                        alert("خطأ في التحقق من صحة البيانات:\n" + errorMessages);
                    } else {
                        alert("حدث خطأ أثناء التسجيل: " + (result.message || "خطأ غير معروف"));
                    }
                }
            } catch (error) {
                console.error("Error:", error);
                alert("فشل الاتصال بالخادم. يرجى التأكد من أن الخادم يعمل وأن المسار صحيح.");
            }
        });
    </script> 
</body> 
</html>
